{% extends "base.html" %}

{% block title %}Админ панель{% endblock %}

{% block content %}
<main class="container admin-container">
  <h1>Админ панель</h1>

  <a href="{{ url_for('admin_logout') }}" class="btn-check">Выйти</a>

  <!-- Блоки, доступные только для владельца (owner) -->
  {% if session.admin_role == 'owner' %}
    <p>
      <a href="{{ url_for('admin_register') }}" class="btn-check">Регистрация нового пользователя</a>
    </p>
    <p>
      <a href="{{ url_for('admin_whitelist') }}" class="btn-check">Редактор whitelist</a>
    </p>
    <p>
      <a href="{{ url_for('admin_users') }}" class="btn-check">Управление пользователями</a>
    </p>
    <form method="POST" action="{{ url_for('update_nicknames') }}" style="margin-top: 20px;">
      <button type="submit" class="btn-check">Обновить ники</button>
    </form>
  {% endif %}

  <!-- Блок добавления записи в черный список (доступен для owner и admin) -->
  {% if session.admin_role in ['owner', 'admin'] %}
    <h2>Добавить запись в черный список</h2>
    <form method="POST" action="{{ url_for('admin_panel') }}">
      <div class="input-group">
        <input type="text" name="nickname" placeholder="Никнейм" required />
      </div>
      <div class="input-group">
        <input type="text" name="reason" placeholder="Причина" required />
      </div>
      <button type="submit" class="btn-check">Добавить</button>
    </form>
  {% else %}
    <p>У вас нет доступа для добавления записей в ЧС.</p>
  {% endif %}

  <h2>Список записей в ЧС</h2>
  <ul id="blacklist">
    {% for entry in entries %}
      <li>
        {{ entry.nickname }} – {{ entry.reason }}
        <!-- Возможность удалить запись доступна для owner и admin -->
        {% if session.admin_role in ['owner', 'admin'] %}
          <form method="POST" action="{{ url_for('delete_entry', entry_id=entry.id) }}" style="display:inline;">
            <button type="submit" class="btn-check" style="background-color: red;">Удалить</button>
          </form>
        {% endif %}
        <!-- Ссылка для обновления причины доступна для owner и moderator -->
        {% if session.admin_role in ['owner', 'admin', 'moderator'] %}
          <a href="{{ url_for('update_reason', entry_id=entry.id) }}" class="btn-check">Изменить причину</a>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</main>
{% endblock %}
